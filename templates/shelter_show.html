{% extends 'base.html' %}

{% block header %}
  <h3>{% block title %}Übersicht Unterkunft{% endblock %}</h3>
{% endblock %}

{% block content %}

{% if session['logged_in'] %}
  <a href="{{ url_for('edit_shelter', uuid=shelter.uuid) }}">Unterkunft editieren</a> |
  <a href="#reservierungen">Reservierungen anzeigen</a> |
{% endif %}
  <a href="#share">Unterkunft teilen</a>
</br>
</br>


<table class="table">
  <tbody>
    <tr>
      <td>Name</td>
      <td>{{ shelter.name }}</td>
    </tr>
    <tr>
      <td>Pronomen</td>
      <td>{{ shelter.pronoun }}</td>
    </tr>
    <tr>
      <td>Telefonnummer</td>
      <td>{{ shelter.telephone }}</td>
    </tr>
    <tr>
      <td>Addresse</td>
      {% if shelter.longitude %}
      <td>{{ shelter.address }} <a href="https://www.google.com/maps/search/{{ shelter.longitude }},{{ shelter.latitude }}" >(Google Maps)</a></td>
      {% else %}
      <td>{{ shelter.address }} <a href="https://www.google.com/maps/search/{{ shelter.address }}" >(Google Maps)</a></td>
      {% endif %}
    </tr>
    <tr>
      <td>Schlafplätze ohne Isomatte</td>
      <td>{{ shelter.beds_basic }}</td>
    </tr>
    <tr>
      <td>Schlafplätze mit Isomatte</td>
      <td>{{ shelter.beds_luxury }}</td>
    </tr>
    <tr>
      <td>Zeitraum</td>
      {% if shelter.date_from_june %}
        <td>{{ shelter.date_from_june.strftime("%d.%m. (%a)") }}
      {% else %}
        <td>nicht angegeben
      {% endif %}
      bis
      {% if shelter.date_to_june %}
        {{ shelter.date_to_june.strftime("%d.%m. (%a)") }}
      {% else %}
        nicht angegeben</td>
      {% endif %}
      {% if shelter.date_from_june and shelter.date_to_june %} 
        - {{ (shelter.date_to_june - shelter.date_from_june).days }} Tage
      {% endif %}
      </td>
    </tr>

  </tbody>
</table>

Zugang zur Wohnung
<textarea class="form-control" readonly rows=3>
{{ shelter.keys }}
</textarea>
Infos zur Unterkunft
<textarea class="form-control" readonly rows=5>
{{ shelter.rules }}
</textarea>

{% if session['logged_in'] %}
Interner Kommentar (nur für Menschen, die Unterkünfte koordinieren/organisieren)
<textarea class="form-control" readonly rows=3>
{% if shelter.internal_comment %}{{ shelter.internal_comment }}{% endif %}
</textarea>
{% endif %}

&nbsp;

<hr>
<div id="reservierungen"> <h4>Belegung - Wer schläft hier?</h4> </div>
<table class="table">
  <thead>
    <tr>
        <th>Tag</th>
        <th>Datum</th>
        <th>belegte Betten</th>
        <th>Betten insgesamt</th>
        <th>Reservierung ändern</th>
        <th>Wer schläft da nachts?</th>
    </tr>

  </thead>
  <tbody>
{% for date, reservation in reservations.items() %}
    <tr id="reservierung-{{ date.strftime("%d%m") }}">
        <td>{{ date.strftime("%a") }}</td>
        <td>{{ date.strftime("%d.%m.") }}</td>
    {% if reservation %}
        <td>
            {{ reservation.used_beds }}
        </td>
        <td>
            {{  shelter.beds_total }}
        </td>
    {% else %}
        <td>
            0
        </td>
        <td>
            {{  shelter.beds_total }}
        </td>
    {% endif %}
    <td>
        <a href="{{ url_for('edit_reservation', uuid=shelter.uuid, date=date.strftime("%d.%m.%Y")) }}">ändern</a>
    </td>
        <td>
        {% for res in reservation.reservations %}
            {{ res.mensch.name }} ({{ res.mensch.bezugsgruppe }}) 
        {% endfor %}
        </td>
    </tr>
{% endfor %}

  </tbody>
</table>




<hr>
<h4 id="share" >Wohnung teilen</h4>
Menschen müssen eingeloggt sein, um die Reservierungen zu sehen.</br>
Link zur Wohnung:
<div class="alert alert-primary">
{{ base_url + url_for('show_shelter', uuid=shelter.uuid) }}
</div>

Link zur Wohnung (QR-Code):
<br>
<img src="{{ qrcode(base_url + url_for('show_shelter', uuid=shelter.uuid), box_size=5 ) }}">
<br>
&nbsp;

{% endblock %}


